<?xml version="1.0" encoding="UTF-8"?>
<plugin:page xmlns="http://piston.koyad.in/html5" xmlns:plugin="http://piston.koyad.in/plugin"
	xmlns:c="http://piston.koyad.in/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://piston.koyad.in/html5 http://piston.koyad.in/html5 
						http://piston.koyad.in/plugin http://piston.koyad.in/plugin 
						http://piston.koyad.in/core http://piston.koyad.in/core">
	<plugin:head>
		<script type="text/javascript" src="js/globalPermissions.js" context="global"></script>
	</plugin:head>
						
	<plugin:body>
		<style type="text/css">
			td > div {
			    background-color: #e6e6fc;
			    min-height: 100px;
			    min-width: 200px;
			    padding: 10px 10px 0 0;
			}
			.horList1 {
			    list-style: none outside none;
			    margin: 0;
			    padding-left: 0;
			}
			.horList1 > li {
			    background-color: #f7f7f9;
			    border-radius: 2px;
			    display: inline-block;
			    margin-bottom: 10px;
			    margin-left: 10px;
			    padding-left: 10px;
			    padding-right: 10px;
			}
			.prin-del {
			    cursor: pointer;
			    margin-left: 10px;
			}
		</style>
		
		<c:if test="${not empty msg}">
			<p class="msg-container">
				<span class="fa fa-info-circle fa-lg" style="margin-left: 5px; margin-right: 5px; color: white;"></span>
				<c:out value="${msg.details}"/>
			</p>
		</c:if>
		
	    <div style="padding: 15px;">
	        <form name="groupDetails" method="POST" action="saveGroup">
	        	<fieldset>
					<legend>Group information</legend>
	                <ul style="list-style: none;">
	                     <li>Name</li>
	                     <li>
	                     		<text property="name" size="100" />
	                     </li>
	                     <li>Title</li>
	                     <li>
	                    		<text property="title" size="100" />
	                     </li>
	                     <li>Mapping</li>
	                     <li>
	                          	<text property="mapping" size="100" />
	                     </li>
	                     <li>
	                     	<span><checkbox property="enabled" /></span>
	                     	<span>Enabled?</span>
	                     </li>
	                     <li>
	                     	<span><checkbox property="aclInherited" /></span>
	                     	<span>Inherit ACLs?</span>
	                     </li>
	                     <hidden property="id" />
	                     <hidden property="position" />
	                     <hidden property="version" />
	                     
	                </ul>
	        	</fieldset>
	        	
	        	<c:if test="${empty pageDetails.id}">
		        	<fieldset style="margin-top: 20px; padding: 15px;">
						<legend>Select parent</legend>
						<div>
						    <div style="padding: 15px; background-color: #ADD8E6;">
						        <label> 
					        		<span style="padding-right: 8px;">
					        			<b>Select site</b>
					        		</span>
					                <select id="site" property="siteId" options="${sites}" label="metadata.title" value="id">
					                	<option value="">-- Select --</option>
					                </select>
						        </label>
						    </div>
						    <div style="border: 1px solid #ADD8E6;">
						    	<div id="wait" style="display:none;">
						    		<img src="img/ajax-loader.gif" context="global" style="margin: 15px auto; display: block;" />
						    	</div>
						    	<div id="resChildren"></div>
						    </div>
						</div>
					</fieldset>
				</c:if>
	        	
	        	<fieldset style="margin-top: 20px; padding: 20px;">
					<legend>Permissions</legend>
					<table style="width: 100%;"  class="piston-table">
						<tr>
							<th>
								Role
							</th>
							<th>
								Permissions
							</th>
							<th>
								Actions
							</th>
						</tr>
						<tr>
							<td style="text-align:center;">
								<c:out value="MANAGER" />
							</td>
							<td style="padding: 0px;">
								<div id="manager" class="pseudo-permission-container">
									<ul class="horList1">
										<c:iterate items="${pageDetails.manager}" var="mgr">
											<li>
												<span><c:out value="${mgr.split(':')[1]}" /></span>
												<span class="prin-del">x</span>
											</li>
										</c:iterate>
									</ul>
									<c:iterate items="${pageDetails.manager}" var="mgr">
										<input class="pseudo-role" type="hidden" name="manager" value="${mgr}" />
									</c:iterate>
								</div>
							</td>
							<td style="text-align: center;">
								<pButton class="btn pseudo-add-permission" faClass="fa fa-plus fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;"> 
			  						<c:out value="Add" />
					  			</pButton>
							</td>
						</tr>
						<tr>
							<td style="text-align:center;">
								<c:out value="EDITOR" />
							</td>
							<td style="padding: 0px;">
								<div id="editor" class="pseudo-permission-container">
									<ul class="horList1">
										<c:iterate items="${pageDetails.editor}" var="edit">
											<li>
												<span><c:out value="${edit.split(':')[1]}" /></span>
												<span class="prin-del">x</span>
											</li>
										</c:iterate>
									</ul>
									<c:iterate items="${pageDetails.editor}" var="edit">
										<input class="pseudo-role" type="hidden" name="editor" value="${edit}" />
									</c:iterate>
								</div>
							</td>
							<td style="text-align: center;">
								<pButton class="btn pseudo-add-permission" faClass="fa fa-plus fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;"> 
			  						<c:out value="Add" />
					  			</pButton>
							</td>
						</tr>
						<tr>
							<td style="text-align:center;">
								<c:out value="USER" />
							</td>
							<td style="padding: 0px;">
								<div id="user" class="pseudo-permission-container">
									<ul class="horList1">
										<c:iterate items="${pageDetails.user}" var="usr">
											<li>
												<span><c:out value="${usr.split(':')[1]}" /></span>
												<span class="prin-del">x</span>
											</li>
										</c:iterate>
									</ul>
									<c:iterate items="${pageDetails.user}" var="usr">
										<input class="pseudo-role" type="hidden" name="user" value="${usr}" />
									</c:iterate>
								</div>
							</td>
							<td style="text-align: center;">
								<pButton class="btn pseudo-add-permission" faClass="fa fa-plus fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;"> 
			  						<c:out value="Add" />
					  			</pButton>
							</td>
						</tr>
					</table>   
				</fieldset>
				
				<div style="text-align: right; margin-top: 20px;">
					<pButton class="btn pseudo-submit-button" faClass="fa fa-save fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;"> 
		  				<c:if test="${empty pageDetails.id}">
							<c:out value="Create" />
						</c:if>
						<c:if test="${not empty pageDetails.id}">
							<c:out value="Update" />
						</c:if>
		  			</pButton>
					<plugin:actionURL action="getSitePageChildren" class="btn" faClass="fa fa-close fa-lg" faStyle="font-size: 1.2em; padding-right: 6px;">
						<c:out value="Close" />
						<plugin:param name="siteId" value="${pageDetails.siteId}" />
						<plugin:param name="parentId" value="${pageDetails.parentId}" />
					</plugin:actionURL>
				</div>
            </form>
            
            <div id="searchScreen" style="border: 1px solid #ADD8E6; display:none;">
		    	<div id="waitSearchScreen">
		    		<img src="img/ajax-loader.gif" style="margin: 15px auto;" context="global" />
		    	</div>
		    	<div id="searchScreenBody"></div>
		    </div>
		
			<script type="text/javascript">
	        	<![CDATA[
	        		$(function() {
	        			$('#site').change(function() {
					        $('#resChildren').html("");
					        
					        var siteId = $('#site').val();
					        if(siteId != "") {
					        	$('#wait').show();
					        	var form = createPluginForm($(this), 'ajaxGetSitePageChildren');
								form.append(createHidden('siteId', siteId));
								//form.append(createHidden('scenario', 'createUpdatePage'));
								$.ajax({
						    		async : false,
						            url: '/piston/ajaxPlugin',
						            type: 'POST',
									data: form.serializeArray(),
						            success: function(data) {
						                $('#wait').hide();
										$('#resChildren').html(data);
						            }
						    	});
							}
					    });
					    /*
					    $('.pseudo-close').click(function() {
				     		var form = createPluginForm($(this), 'pageDetails'); 
				     	 	form.appendTo('.pseudo-tile-content');
				     	 	form.submit();
				     	}); 
				     	*/
	        		});
	        	]]>
	        </script>
	    </div>
	</plugin:body>
</plugin:page>
