<?xml version="1.0" encoding="UTF-8"?>
<project name="Deploy User Management" basedir="." default="redeployUserMgmt">

	<property environment="env" />

	<target name="stopTomcat">
		<echo message="Stopping tomcat .." />
		<exec dir="${env.CATALINA_HOME}\bin" executable="cmd" failifexecutionfails="false">
			<arg line="/c catalina.bat stop" />
		</exec>
		<sleep seconds="5" />
	</target>

	<target name="updateUserMgmt">
		<echo message="Building package .." />
		<exec dir="${env.PISTON_SERVICES_REPO}/piston-rest-userManagement" executable="cmd">
			<arg line="/c gradle clean assemble" />
		</exec>

		<echo message="Deleting userMgmt folder from tomcat webapps .." />
		<delete dir="${env.CATALINA_HOME}/webapps/userMgmt" />

		<copy file="${env.PISTON_SERVICES_REPO}/piston-rest-userManagement/build/package/piston-rest-userManagement-1.0-rc1.war" tofile="${env.CATALINA_HOME}/webapps/userMgmt.war" />
	</target>

	<target name="startTomcat">
		<echo message="Starting tomcat .." />
		<exec dir="${env.CATALINA_HOME}\bin" executable="cmd">
			<arg line="/c catalina.bat jpda run" />
		</exec>
	</target>

	<target name="redeployUserMgmt">
		<antcall target="stopTomcat" />
		<antcall target="updateUserMgmt" />
		<antcall target="startTomcat" />
	</target>

	<target name="restartTomcat">
		<antcall target="stopTomcat" />
		<antcall target="startTomcat" />
	</target>
</project>